#!/usr/bin/env bash

# Roll dependencies; assumes they are checked out in sibling directories
# * https://github.com/a2stuff/prodos-drivers - CLOCK.SYSTEM
# * https://github.com/a2stuff/intbasic - INTBASIC.SYSTEM
# * https://github.com/StewBC/pt3plr - PT3PLR.SYSTEM

set -e
cd "$(dirname "$0")/.."
source "bin/util.sh"

roll () {
    spath="$1"
    sfile="$2"
    tpath="$3"
    tfile="$4"
    if ! diff -q "$spath/$sfile" "$tpath/$tfile" > /dev/null; then
        cp "$spath/$sfile" "$tpath/$tfile"
        echo "roll $tfile to "$(cd "$spath" && git rev-parse --short HEAD)
    fi
}

roll "../intbasic" "out/intbasic.system.SYS" "res/package" "INTBASIC.SYSTEM"
roll "../prodos-drivers/" "clocks/jumbo/out/clock.system.SYS" "res/package" "CLOCK.SYSTEM"
roll "../pt3plr" "pt3plr.apple2" "res/package" "PT3PLR.SYSTEM"
